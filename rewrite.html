<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>改寫＋翻譯前端範例</title>
</head>
<body>
  <h2>文章改寫與翻譯</h2>
  <textarea id="inputText" rows="6" cols="60" placeholder="請輸入文章內容"></textarea><br/>
  <input type="text" id="inputTopic" placeholder="主題（可選）" /><br/>
  <select id="selectLang">
    <option value="zh">繁體中文</option>
    <option value="en">英文</option>
    <option value="zh-CN">簡體中文</option>
    <option value="vi">越南文</option>
  </select><br/>
  <input type="text" id="inputUserId" placeholder="User ID" /><br/>
  <button id="btnRewrite">送出改寫＋翻譯</button>

  <h3>改寫結果：</h3>
  <div id="resultArea"></div>

  <script>
    document.getElementById('btnRewrite').addEventListener('click', () => {
      const userId = document.getElementById('inputUserId').value.trim();
      const text = document.getElementById('inputText').value.trim();
      const topic = document.getElementById('inputTopic').value.trim();
      const lang = document.getElementById('selectLang').value;

      if (!userId) {
        alert('請輸入 User ID');
        return;
      }
      if (!text) {
        alert('請輸入文章內容');
        return;
      }

      const payload = {
        action: "rewrite",
        userId: userId,
        text: text,
        topic: topic,
        lang: lang
      };

      fetch('https://script.google.com/macros/s/AKfycbwRYOIicltP81EO6fQB81bCRfoEczp29qqqSbz5HjdzbsZmRrccQgxR6QmikAWuuNGl/exec', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(data => {
        if (data.error) {
          document.getElementById('resultArea').innerText = "錯誤: " + data.error;
        } else {
          let html = `<strong>標題：</strong>${data.title}<br/>`;
          html += `<strong>分類：</strong>${data.topic}<br/>`;
          html += `<strong>改寫內容：</strong><p>${data.content}</p>`;
          html += `<strong>使用者：</strong>${data.userName}<br/>`;
          if (data.expires) {
            html += `<strong>授權到期：</strong>${data.expires}（剩餘${data.remainingDays}天）`;
          }
          document.getElementById('resultArea').innerHTML = html;
        }
      })
      .catch(err => {
        document.getElementById('resultArea').innerText = "請求失敗：" + err.message;
      });
    });
  </script>
</body>
</html>
